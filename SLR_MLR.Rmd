---
title: "SLR_MLR"
output: pdf_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(message=FALSE, warning=FALSE, fig.height=3, fig.width=5, fig.align = "center")
library(dplyr)
library(ggplot2)
library(infer)
library(skimr)
library(broom)
library(mosaic)
library(knitr)
library(readr)
options(digits=3)
```

```{r}
movies <- read_csv("~/LM HW/SLM_Project/tmdb_5000_movies-OG.csv")

#Add variable if "man" or "men" is in the title
library(stringr)
test <- c("superman", "man", "table", "spider-man", "supermen","men")
grepl("man|men", test)

is.man <- grepl("man|men", movies$title)
men.true <- c()
for(i in is.man){
  if(i == TRUE){
    men.true <- append(1, men.true)
  }else if (i == FALSE){
    men.true <- append(0, men.true)
  } else{
    men.true <- append(3, men.true)
  }
}
movies$men = rev(men.true)

#Pairs plot
pairs(~popularity + budget + revenue + vote_average + men, data=movies, pch=19)

#residual plot for popularity vs. budget
pop.budget <- lm(popularity ~ budget, data = movies)
ggplot(pop.budget, aes(x=fitted(pop.budget), y=resid(pop.budget))) + geom_point()

#requires log transformation so removing 0 values
budget <- movies %>%
  select(popularity, budget) %>%
  filter(budget > 0, popularity > 0)

pop.budget2 <- lm(log(popularity) ~ log(budget), data = budget)
ggplot(pop.budget2, aes(x=fitted(pop.budget2), y=resid(pop.budget2))) + geom_point()

#residual plot for popularity vs. revenue
pop.rev <- lm(popularity ~ revenue, data = movies)
ggplot(pop.rev, aes(x=fitted(pop.rev), y=resid(pop.rev))) + geom_point()

#remove 0 values and log transform popularity and revenue
revenue <- movies %>%
  select(popularity, revenue) %>%
  filter(revenue > 0, popularity > 0)
pop.rev2 <- lm(log(popularity) ~ log(revenue), data = revenue)
ggplot(pop.rev2, aes(x=fitted(pop.rev2), y=resid(pop.rev2))) + geom_point()

#residual plot for popularity vs. vote average
pop.vote <- lm(popularity ~ vote_average, data = movies)
ggplot(pop.vote, aes(x=fitted(pop.vote), y=resid(pop.vote))) + geom_point()

vote <- movies %>%
  select(popularity, vote_average) %>%
  filter(popularity > 0, vote_average >0)
pop.vote2 <- lm(log(popularity) ~ vote_average, data = vote)
ggplot(pop.vote2, aes(x=fitted(pop.vote2), y=resid(pop.vote2))) + geom_point()

#residual plot for popularity and men
pop.men <- lm(popularity ~ men, data = movies)
ggplot(pop.men, aes(x=fitted(pop.men), y=resid(pop.men))) + geom_point()

men <- movies %>%
  select(popularity, men) %>%
  filter(popularity > 0)
pop.men2 <- lm(log(popularity) ~ men, data = men)
ggplot(pop.men2, aes(x=fitted(pop.men2), y=resid(pop.men2))) + geom_point()


#Create LM
movies.lm <- lm(popularity ~ budget + revenue + vote_average + men, data=movies)
summary(movies.lm)
anova(movies.lm)
tidy(movies.lm)
plot(movies.lm)
```